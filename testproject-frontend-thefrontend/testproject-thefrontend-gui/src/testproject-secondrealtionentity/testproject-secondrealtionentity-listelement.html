<!--
  This file will be overwritten on every change of the model!
  This file was automatically generated by Barrakuda.
-->
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/nebula-i18n/nebula-i18n.html">

<link rel="import" href="../testproject-icons.html">
<link rel="import" href="../behaviors/testproject-list-behavior.html">
<link rel="import" href="../behaviors/testproject-error-behavior.html">		
<link rel="import" href="../behaviors/nebula-polyglot-behavior.html">
<link rel="import" href="../behaviors/mixin.html">

<dom-module id="testproject-secondrealtionentity-listelement">
    <template>
      <style is="custom-style">
      	:host {
      		@apply --testproject-secondrealtionentity-listelement;
      	}
      </style>
      <paper-icon-item id="item-[[item.id]]" disabled="[[readonly]]">
        <template is="dom-if" if="[[showIcons]]">
        <iron-icon icon="testproject-icons:[[_entity]]" slot="item-icon" on-click="_onEdit"></iron-icon>
      </template>
      
        <template is="dom-if" if="[[!singleLine]]">
          <paper-item-body two-line on-click="_onEdit">
            <div>[[_format('list_first_line', item)]]</div>
            <div secondary>[[_format('list_second_line', item)]]</div>
          </paper-item-body>
        </template>
        
        <template is="dom-if" if="[[singleLine]]">
          <paper-item-body>
            <div>[[_format('list_first_line', item)]]</div>
          </paper-item-body>
        </template>
        
        <template is="dom-if" if="[[!readonly]]">
          <paper-icon-button 
            icon="testproject-icons:link-off" 
            hidden="[[hideRemove]]"
            on-tap="_onRemove">
          </paper-icon-button>
          <paper-icon-button
            icon="testproject-icons:delete"
            id="item-delete-[[item.id]]"
            hidden="[[hideDelete]]"
            on-click="_onDelete">
          </paper-icon-button>
          <paper-icon-button
            icon="testproject-icons:mode-edit"
            id="item-edit-[[item.id]]"
            hidden="[[hideEdit]]"
            on-click="_onEdit">
          </paper-icon-button>
        </template>
      </paper-icon-item>
    </template>

    <script>
      /*
       * `testproject-secondrealtionentity-listelement` stellt einen einzelnen Eintrag in der Listenanzeige von Entitäten dar.
       *
       * @polymer
       * @customElement
       * @polymerBehavior Nebula.PolyglotBehavior
       * 
       **/
      class TestprojectSecondrealtionentityListElement extends mix(Polymer.Element).with(Nebula.PolyglotBehavior) {

        static get is() { return 'testproject-secondrealtionentity-listelement'; }

        static get properties() {
          return {
          	/**
          	 * Das '_domain' Property wird benötigt, um den richtigen Pfad 
          	 * zu den i18n Werten in der `locales.json` zu erzeugen. Es wird in jedem Element 
          	 * benötigt, welches das `Nebula.PolyglotBehavior` einbindet.
          	 *
          	 * Entgegen der Namensgebung kann hier auch 'view' angegeben werden, wenn in `entity`
          	 * eine View referenziert werden soll.
          	 *
          	 * Der vollständige Pfad setzt sich zusammen aus den Properties `lang`.`_domain`.`_entity`.`key`.
          	 */
          	_domain: {
          	    type: String,
          		value: 'testproject'
          	},
          	/*
          	 * Das '_entity' Property wird benötigt, um den richtigen Pfad 
          	 * zu den i18n Werten in der `locales.json` zu erzeugen. Es wird in jedem Element 
          	 * benötigt, welches das `Nebula.PolyglotBehavior` einbindet.
          	 *
          	 * Entgegen der Namensgebung können hier auch Views bzw. Custom Pfade angegeben werden.
          	 *
          	 * Der vollständige Pfad setzt sich zusammen aus den Properties `lang`.`_domain`.`_entity`.`key`.
          	 */
          	_entity: {
          	    type: String,
          	    value: 'SecondRealtionEntity'
          	}
          	,
            item: {
              type: Object
            },
            showIcons: {
              type: Boolean
            },
            hideDelete: {
              type: Boolean,
              value: false
            },
            hideEdit: {
              type: Boolean,
              value: false
            },
            hideRemove: {
              type: Boolean,
              value: false
            },
            singleLine: {
              type: Boolean,
              value: false
            },
            readonly: {
              type: Boolean,
              value: false
            }
          }
        }

        _onEdit(e) {
          this.dispatchEvent(new CustomEvent('edit-row', {
            bubbles: true,
            composed: true,
             detail: {
                type: this._entity,
                id: this.item.id
            }
          }));
        }

        _onDelete(e) {
          let item = this.item;
          let deleteInfo = this.$t('modal_deleteinfo', {theEntityText: item.theEntityText});
          this.dispatchEvent(new CustomEvent('delete-row', {
            bubbles: true,
            composed: true,
            detail: {
              deleteInfo: deleteInfo
            }
          }));
        }
        
        _onRemove(e) {
          this.dispatchEvent(new CustomEvent('remove-row', {
            bubbles: true,
            composed: true,
            detail: {
              id: this.item.id
            }
          }));
        }

		/*
		 * Bereitet die Ausgabe der Einträge in der Liste
		 * nach den Vorgaben in der locales Datei auf. Dies
		 * ist notwendig, weil man im HTML Bereich Databinding
		 * nicht schachteln kann.
		 *
		 * @param   item das anzuzeigende Element
		 * @return  formatierter Text
		 */
		_format(key, item) {
		        var translatedItem =  this.translateItem(item, 
		        	[],
		        	[],
		        );
		        
		        return this.$t(key, {
		            "theEntityText": this._safelyGet("", ["theEntityText"], item),
		        });
		}

		/**
		 * Löst den angegeben Pfad auf dem Objekt auf. Gibt den Default-Value zurück, falls der Pfad nicht aufgelöst werden kann.
		 * @param defaultValue der Default-Wert, falls der Pfad nicht bis zum Ende navigiert werden kann
		 * @param {Array} path der zu navigierende Pfad auf dem Objekt
		 * @param object das Objekt, auf dem navigiert wird
		 */
		_safelyGet(defaultValue, path, object) {
		  return path.reduce((xs, x) => (xs && xs[x]) ? xs[x] : defaultValue, object);
		}

      }

      customElements.define(TestprojectSecondrealtionentityListElement.is, TestprojectSecondrealtionentityListElement);
    </script>

</dom-module>
